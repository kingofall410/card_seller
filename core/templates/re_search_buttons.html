<div style="margin-top: 20px; display: flex; gap: 10px;">
    <button id="image-search-btn-{{ card_id }}" style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer;">
        ğŸ–¼ï¸ Image Search
    </button>
    <button id="text-search-btn-{{ card_id }}" style="padding: 8px 16px; background-color: #2ecc71; color: white; border: none; border-radius: 6px; cursor: pointer;">
        ğŸ”¤ Text Search
    </button>
    <button id="export-btn-{{ card_id }}" style="padding: 8px 16px; background-color: #2ecc71; color: white; border: none; border-radius: 6px; cursor: pointer;">
    ğŸš€ Export
    </button>
    <button id="retokenize-btn-{{ card_id }}" style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer;">
        ğŸ” Retokenize
    </button>
    <button id="crop-btn-{{ card_id }}" style="padding: 8px 16px; background-color: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer;">
        âœ‚ Crop
    </button>
    <a href="/export/{{ search_result.id }}/" download="card_collection.csv">Download CSV</a>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const imageSearchBtn = document.getElementById("image-search-btn-{{ card_id }}");
        const retokenizeBtn = document.getElementById("retokenize-btn-{{ card_id }}");
        const textSearchBtn = document.getElementById("text-search-btn-{{ card_id }}");
        const exportBtn = document.getElementById("export-btn-{{ card_id }}");
        const cropBtn = document.getElementById("export-btn-{{ card_id }}");
        const searchResultId = "{{ search_result.id }}"
        const cardId = "{{ card_id }}";

        imageSearchBtn.addEventListener('click', () => {
            console.log(`ğŸ–¼ï¸ Image Search triggered for ${imageSearchBtn.id}`);
            fetch(`/image_search/${cardId}/`, { 
                method: 'POST',
            }).then(response => {
                console.log("Successfully");
                location.reload()
            }).catch(error => {
                console.error("Save error", error);
            });
        });
        retokenizeBtn.addEventListener('click', () => {
            fetch(`/retokenize/${searchResultId}/`, { 
                method: 'POST',
            }).then(response => {
                console.log("Successfully");
                location.reload()
            }).catch(error => {
                console.error("Save error", error);
            });
        });
        exportBtn.addEventListener('click', () => {
            console.log(` Export triggered for ${exportBtn.id}`);
            console.log(searchResultId);
            fetch(`/export/${searchResultId}/`)
                .then(res => res.json())
                
        });
        cropBtn.addEventListener('click', () => {
            console.log(` Detailed Crop page `);
                
        });
        
        textSearchBtn.addEventListener('click', () => {
            console.log("ğŸ”¤ Text Search triggered for fields-1");
            
            // Show loading indicator
            textSearchBtn.innerHTML = "ğŸ”„ Searching...";
            textSearchBtn.disabled = true;

            fetch(`/text_search/${cardId}/`, { 
                method: 'POST',
            }).then(response => {
                console.log("Successfully");
                location.reload()
            }).catch(error => {
                console.error("Save error", error);
                
                // Restore button state on error
                textSearchBtn.innerHTML = "ğŸ” Text Search";
                textSearchBtn.disabled = false;
            });
        });
    });
</script>